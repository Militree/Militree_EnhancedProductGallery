!function(a){var b={STEP_SIZE:5,KEY_ENTER:13,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_ESC:27,swatchOptionId:null,ElevateZoom:null,flexsliderContainer:a("#flexslider"),keyboardZoomBound:!1,init:function(){b.swatchLink=a(".swatch-link"),b.bindSwatches(),b.initFlexslider(),b.toggleKeyboardSlide("on")},initFlexslider:function(){b.flexsliderContainer.removeData("flexslider"),b.flexsliderContainer.flexslider({animation:"slide",controlNav:!1,slideshow:!1,keyboard:!1,before:function(){b.destroyZoom()},after:function(){b.createZoom(a(".flex-active-slide img"))}})},bindSwatches:function(){b.swatchLink.on("click",function(){b.swatchOptionId=a(this).attr("id").slice(6),b.setSlides()})},setSlides:function(){var a=b.prepareSlidesHtml();b.smartReplace(b.flexsliderContainer,a),b.initFlexslider()},prepareSlidesHtml:function(){var c=b.getSlidesSrc(),d='<ul class="slides product-image-gallery">';return a.each(c,function(a,b){d+='<li><img id="image-'+b.img_id+'" src="'+b.src+'" class="gallery-image lazyautosizes lazyloaded" data-zoom-image="'+b.zoom+'"></li>'}),d+="</ul>"},getSlidesSrc:function(){return AssociatedProductImages.products.filter(function(a){return a.swatch===b.swatchOptionId?a:void 0})[0].images},smartReplace:function(b,c){b.wrapInner("<div class='death-row'></div>"),b.append(c),a(".death-row").remove()},createZoom:function(a){if(PointerManager.getPointer()!=PointerManager.TOUCH_POINTER_TYPE&&!Modernizr.mq("screen and (max-width:"+bp.medium+"px)")){if(!b.isLargeImage(a))return void a.parents(".product-image").removeClass("zoom-available");a.parents(".product-image").addClass("zoom-available"),a.elevateZoom(),b.bindKeyboardZoom(a)}},destroyZoom:function(){a(".zoomContainer").remove(),a(".product-image-gallery .gallery-image").removeData("elevateZoom")},isLargeImage:function(a){if(1===a.length){var b=a[0].naturalWidth-a.width(),c=a[0].naturalHeight-a.height();return b>=0||c>=0}},bindKeyboardZoom:function(c){a("#flexslider").on("keydown",function(a){a.keyCode==b.KEY_ENTER&&b.keyboardZoomBound===!1&&b.keyboardZoom(a,c)})},toggleKeyboardSlide:function(c){return"off"===c?void a(document).off("keyup.keyboardSlide"):void(1===b.flexsliderContainer.length&&a(document).on("keyup.keyboardSlide",function(a){var c=a.keyCode,d=b.flexsliderContainer.data("flexslider");if(!d.animating&&(39===c||37===c)){var e=39===c?d.getTarget("next"):37===c?d.getTarget("prev"):!1;d.flexAnimate(e,d.vars.pauseOnAction)}}))},keyboardZoom:function(c,d){b.keyboardZoomBound=!0,ElevateZoom=d.data("elevateZoom"),ElevateZoom.setPosition(b.calcCenterPosition(ElevateZoom,d)),d.mouseover(),b.toggleKeyboardSlide("off"),a(document).on("keydown",function(a){if(a.keyCode==b.KEY_UP)b.handleKeyboardPan(ElevateZoom,d,0,-1);else if(a.keyCode==b.KEY_DOWN)b.handleKeyboardPan(ElevateZoom,d,0,1);else if(a.keyCode==b.KEY_LEFT)b.handleKeyboardPan(ElevateZoom,d,-1,0);else if(a.keyCode==b.KEY_RIGHT)b.handleKeyboardPan(ElevateZoom,d,1,0);else{if(a.keyCode!=b.KEY_ESC)return;if(!ElevateZoom.isLensActive)return;d.mouseleave(),b.toggleKeyboardSlide("on"),ElevateZoom.setElements("hide"),ElevateZoom.keyFocus=!1,b.keyboardZoomBound=!1}a.preventDefault()})},handleKeyboardPan:function(a,c,d,e){a.currentLoc||(a.currentLoc=b.calcCenterPosition(a,c)),a.currentLoc.clientX+=d*b.STEP_SIZE,a.currentLoc.clientY+=e*b.STEP_SIZE,a.currentLoc.pageX+=d*b.STEP_SIZE,a.currentLoc.pageY+=e*b.STEP_SIZE,a.currentLoc=b.clampPositionToBounds(a,c,a.currentLoc),a.setPosition(a.currentLoc),a.lastX=a.currentLoc.clientX,a.lastY=a.currentLoc.clientY},recalcElemPos:function(a,b){a.nzWidth=b.width(),a.nzHeight=b.height(),a.nzOffset=b.offset()},calcCenterPosition:function(a,c){b.recalcElemPos(a,c);var d=b.calcPositionBounds(a,c),e={pageX:a.nzOffset.left+Math.floor(d.left+(d.right-d.left)/2),pageY:a.nzOffset.top+Math.floor(d.top+(d.bottom-d.top)/2)};return e.clientX=e.pageX,e.clientY=e.pageY,e},calcPositionBounds:function(a,b){var c={};return"window"==a.options.zoomType&&(c.top=a.zoomLens.height()/2,c.bottom=a.nzHeight-a.zoomLens.height()/2-2*a.options.lensBorderSize,c.left=0+a.zoomLens.width()/2,c.right=a.nzWidth-a.zoomLens.width()/2-2*a.options.lensBorderSize),"inner"==a.options.zoomType&&(c.top=a.nzHeight/2/a.heightRatio,c.bottom=a.nzHeight-a.nzHeight/2/a.heightRatio,c.left=0+a.nzWidth/2/a.widthRatio,c.right=a.nzWidth-a.nzWidth/2/a.widthRatio-2*a.options.lensBorderSize),c},clampPositionToBounds:function(a,c,d){b.recalcElemPos(a,c);var e=b.calcPositionBounds(a,c);return d.pageX<e.left+a.nzOffset.left?d.pageX=e.left+a.nzOffset.left:d.pageX>e.right+a.nzOffset.left&&(d.pageX=e.right+a.nzOffset.left),d.pageY<e.top+a.nzOffset.top?d.pageY=e.top+a.nzOffset.top:d.pageY>e.bottom+a.nzOffset.top&&(d.pageY=e.bottom+a.nzOffset.top),d}};window.ProductMediaSlider=b}(jQuery),ProductMediaSlider.init();