!function(e){var o={STEP_SIZE:5,KEY_ENTER:13,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_ESC:27,swatchOptionId:null,ElevateZoom:null,flexsliderContainer:e("#flexslider"),keyboardZoomBound:!1,init:function(){o.swatchLink=e(".swatch-link"),o.bindSwatches(),o.initFlexslider(),o.toggleKeyboardSlide("on")},initFlexslider:function(){o.flexsliderContainer.removeData("flexslider"),o.flexsliderContainer.flexslider({animation:"slide",controlNav:!1,slideshow:!1,keyboard:!1,before:function(){o.destroyZoom()},after:function(){o.createZoom(e(".flex-active-slide img"))}}),o.destroyZoom(),o.createZoom(e(".flex-active-slide img"))},bindSwatches:function(){o.swatchLink.on("click",function(){o.swatchOptionId=e(this).attr("id").slice(6),o.setSlides()})},setSlides:function(){var e=o.prepareSlidesHtml();o.smartReplace(o.flexsliderContainer,e),o.initFlexslider()},prepareSlidesHtml:function(){var t=o.getSlidesSrc(),n='<ul class="slides product-image-gallery">';return e.each(t,function(e,o){n+='<li><img id="image-'+o.img_id+'" src="'+o.src+'" class="gallery-image lazyautosizes lazyloaded" data-zoom-image="'+o.zoom+'"></li>'}),n+="</ul>"},getSlidesSrc:function(){return AssociatedProductImages.products.filter(function(e){return e.swatch===o.swatchOptionId?e:void 0})[0].images},smartReplace:function(o,t){o.wrapInner("<div class='death-row'></div>"),o.append(t),e(".death-row").remove()},createZoom:function(e){if(PointerManager.getPointer()!=PointerManager.TOUCH_POINTER_TYPE&&!Modernizr.mq("screen and (max-width:"+bp.medium+"px)")){if(!o.isLargeImage(e))return void e.parents(".product-image").removeClass("zoom-available");e.parents(".product-image").addClass("zoom-available"),e.elevateZoom(),o.bindKeyboardZoom(e)}},destroyZoom:function(){e(".zoomContainer").remove(),e(".product-image-gallery .gallery-image").removeData("elevateZoom")},isLargeImage:function(e){var o=new Image;o.src=e.attr("src");var t=o.width*o.height,n=e.attr("data-image-size");return n>t},bindKeyboardZoom:function(t){e("#flexslider").on("keydown",function(e){e.keyCode==o.KEY_ENTER&&o.keyboardZoomBound===!1&&o.keyboardZoom(e,t)})},toggleKeyboardSlide:function(t){return"off"===t?void e(document).off("keyup.keyboardSlide"):void(1===o.flexsliderContainer.length&&e(document).on("keyup.keyboardSlide",function(e){var t=e.keyCode,n=o.flexsliderContainer.data("flexslider");if(!n.animating&&(39===t||37===t)){var i=39===t?n.getTarget("next"):37===t?n.getTarget("prev"):!1;n.flexAnimate(i,n.vars.pauseOnAction)}}))},keyboardZoom:function(t,n){o.keyboardZoomBound=!0,ElevateZoom=n.data("elevateZoom"),ElevateZoom.setPosition(o.calcCenterPosition(ElevateZoom,n)),n.mouseover(),o.toggleKeyboardSlide("off"),e(document).on("keydown",function(e){if(e.keyCode==o.KEY_UP)o.handleKeyboardPan(ElevateZoom,n,0,-1);else if(e.keyCode==o.KEY_DOWN)o.handleKeyboardPan(ElevateZoom,n,0,1);else if(e.keyCode==o.KEY_LEFT)o.handleKeyboardPan(ElevateZoom,n,-1,0);else if(e.keyCode==o.KEY_RIGHT)o.handleKeyboardPan(ElevateZoom,n,1,0);else{if(e.keyCode!=o.KEY_ESC)return;if(!ElevateZoom.isLensActive)return;n.mouseleave(),o.toggleKeyboardSlide("on"),ElevateZoom.setElements("hide"),ElevateZoom.keyFocus=!1,o.keyboardZoomBound=!1}e.preventDefault()})},handleKeyboardPan:function(e,t,n,i){e.currentLoc||(e.currentLoc=o.calcCenterPosition(e,t)),e.currentLoc.clientX+=n*o.STEP_SIZE,e.currentLoc.clientY+=i*o.STEP_SIZE,e.currentLoc.pageX+=n*o.STEP_SIZE,e.currentLoc.pageY+=i*o.STEP_SIZE,e.currentLoc=o.clampPositionToBounds(e,t,e.currentLoc),e.setPosition(e.currentLoc),e.lastX=e.currentLoc.clientX,e.lastY=e.currentLoc.clientY},recalcElemPos:function(e,o){e.nzWidth=o.width(),e.nzHeight=o.height(),e.nzOffset=o.offset()},calcCenterPosition:function(e,t){o.recalcElemPos(e,t);var n=o.calcPositionBounds(e,t),i={pageX:e.nzOffset.left+Math.floor(n.left+(n.right-n.left)/2),pageY:e.nzOffset.top+Math.floor(n.top+(n.bottom-n.top)/2)};return i.clientX=i.pageX,i.clientY=i.pageY,i},calcPositionBounds:function(e,o){var t={};return"window"==e.options.zoomType&&(t.top=e.zoomLens.height()/2,t.bottom=e.nzHeight-e.zoomLens.height()/2-2*e.options.lensBorderSize,t.left=0+e.zoomLens.width()/2,t.right=e.nzWidth-e.zoomLens.width()/2-2*e.options.lensBorderSize),"inner"==e.options.zoomType&&(t.top=e.nzHeight/2/e.heightRatio,t.bottom=e.nzHeight-e.nzHeight/2/e.heightRatio,t.left=0+e.nzWidth/2/e.widthRatio,t.right=e.nzWidth-e.nzWidth/2/e.widthRatio-2*e.options.lensBorderSize),t},clampPositionToBounds:function(e,t,n){o.recalcElemPos(e,t);var i=o.calcPositionBounds(e,t);return n.pageX<i.left+e.nzOffset.left?n.pageX=i.left+e.nzOffset.left:n.pageX>i.right+e.nzOffset.left&&(n.pageX=i.right+e.nzOffset.left),n.pageY<i.top+e.nzOffset.top?n.pageY=i.top+e.nzOffset.top:n.pageY>i.bottom+e.nzOffset.top&&(n.pageY=i.bottom+e.nzOffset.top),n}};window.ProductMediaSlider=o}(jQuery),ProductMediaSlider.init();
