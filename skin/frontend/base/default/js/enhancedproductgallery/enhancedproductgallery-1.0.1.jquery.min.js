!function(e){var o={STEP_SIZE:5,KEY_ENTER:13,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_ESC:27,swatchOptionId:null,ElevateZoom:null,flexsliderContainer:e("#flexslider"),keyboardZoomBound:!1,init:function(){o.swatchLink=e(".swatch-link"),o.bindSwatches(),o.initFlexslider(),o.toggleKeyboardSlide("on")},initFlexslider:function(){o.flexsliderContainer.removeData("flexslider"),o.flexsliderContainer.flexslider({animation:"slide",controlNav:!1,slideshow:!1,keyboard:!1,before:function(){o.destroyZoom()},after:function(){o.createZoom(e(".flex-active-slide img"))}}),o.destroyZoom(),o.createZoom(e(".flex-active-slide img"))},bindSwatches:function(){o.swatchLink.on("click",function(){o.swatchOptionId=e(this).attr("id").slice(6),o.setSlides()})},setSlides:function(){var e=o.prepareSlidesHtml();o.smartReplace(o.flexsliderContainer,e),o.initFlexslider()},prepareSlidesHtml:function(){var t=o.getSlidesSrc(),i='<ul class="slides product-image-gallery">';return e.each(t,function(e,o){i+='<li><img id="image-'+o.img_id+'" src="'+o.src+'" class="gallery-image lazyautosizes lazyloaded" data-zoom-image="'+o.zoom+'"></li>'}),i+="</ul>"},getSlidesSrc:function(){return AssociatedProductImages.products.filter(function(e){return e.swatch===o.swatchOptionId?e:void 0})[0].images},smartReplace:function(o,t){o.wrapInner("<div class='death-row'></div>"),o.append(t),e(".death-row").remove()},createZoom:function(e){if(PointerManager.getPointer()!=PointerManager.TOUCH_POINTER_TYPE&&!Modernizr.mq("screen and (max-width:"+bp.medium+"px)")){if(!o.isLargeImage(e))return void e.parents(".product-image").removeClass("zoom-available");e.parents(".product-image").addClass("zoom-available"),e.elevateZoom(),o.bindKeyboardZoom()}},destroyZoom:function(){e(".zoomContainer").remove(),e(".product-image-gallery .gallery-image").removeData("elevateZoom")},isLargeImage:function(e){var o=new Image;o.src=e.attr("src");var t=o.width*o.height,i=e.data("image-size");return i>t},bindKeyboardZoom:function(){e("#flexslider").on("keydown",function(t){t.keyCode==o.KEY_ENTER&&o.keyboardZoomBound===!1&&o.keyboardZoom(t,e(".flex-active-slide img"))})},toggleKeyboardSlide:function(t){return"off"===t?void e(document).off("keyup.keyboardSlide"):void(1===o.flexsliderContainer.length&&e(document).on("keyup.keyboardSlide",function(e){var t=e.keyCode,i=o.flexsliderContainer.data("flexslider");if(!i.animating&&(39===t||37===t)){var n=39===t?i.getTarget("next"):37===t?i.getTarget("prev"):!1;i.flexAnimate(n,i.vars.pauseOnAction)}}))},keyboardZoom:function(t,i){o.keyboardZoomBound=!0,ElevateZoom=i.data("elevateZoom"),ElevateZoom.setPosition(o.calcCenterPosition(ElevateZoom,i)),i.mouseover(),o.toggleKeyboardSlide("off"),e(document).on("keydown",function(e){if(e.keyCode==o.KEY_UP)o.handleKeyboardPan(ElevateZoom,i,0,-1);else if(e.keyCode==o.KEY_DOWN)o.handleKeyboardPan(ElevateZoom,i,0,1);else if(e.keyCode==o.KEY_LEFT)o.handleKeyboardPan(ElevateZoom,i,-1,0);else if(e.keyCode==o.KEY_RIGHT)o.handleKeyboardPan(ElevateZoom,i,1,0);else{if(e.keyCode!=o.KEY_ESC)return;if(!ElevateZoom.isLensActive)return;i.mouseleave(),o.toggleKeyboardSlide("on"),ElevateZoom.setElements("hide"),ElevateZoom.keyFocus=!1,o.keyboardZoomBound=!1}e.preventDefault()})},handleKeyboardPan:function(e,t,i,n){e.currentLoc||(e.currentLoc=o.calcCenterPosition(e,t)),e.currentLoc.clientX+=i*o.STEP_SIZE,e.currentLoc.clientY+=n*o.STEP_SIZE,e.currentLoc.pageX+=i*o.STEP_SIZE,e.currentLoc.pageY+=n*o.STEP_SIZE,e.currentLoc=o.clampPositionToBounds(e,t,e.currentLoc),e.setPosition(e.currentLoc),e.lastX=e.currentLoc.clientX,e.lastY=e.currentLoc.clientY},recalcElemPos:function(e,o){e.nzWidth=o.width(),e.nzHeight=o.height(),e.nzOffset=o.offset()},calcCenterPosition:function(e,t){o.recalcElemPos(e,t);var i=o.calcPositionBounds(e,t),n={pageX:e.nzOffset.left+Math.floor(i.left+(i.right-i.left)/2),pageY:e.nzOffset.top+Math.floor(i.top+(i.bottom-i.top)/2)};return n.clientX=n.pageX,n.clientY=n.pageY,n},calcPositionBounds:function(e,o){var t={};return"window"==e.options.zoomType&&(t.top=e.zoomLens.height()/2,t.bottom=e.nzHeight-e.zoomLens.height()/2-2*e.options.lensBorderSize,t.left=0+e.zoomLens.width()/2,t.right=e.nzWidth-e.zoomLens.width()/2-2*e.options.lensBorderSize),"inner"==e.options.zoomType&&(t.top=e.nzHeight/2/e.heightRatio,t.bottom=e.nzHeight-e.nzHeight/2/e.heightRatio,t.left=0+e.nzWidth/2/e.widthRatio,t.right=e.nzWidth-e.nzWidth/2/e.widthRatio-2*e.options.lensBorderSize),t},clampPositionToBounds:function(e,t,i){o.recalcElemPos(e,t);var n=o.calcPositionBounds(e,t);return i.pageX<n.left+e.nzOffset.left?i.pageX=n.left+e.nzOffset.left:i.pageX>n.right+e.nzOffset.left&&(i.pageX=n.right+e.nzOffset.left),i.pageY<n.top+e.nzOffset.top?i.pageY=n.top+e.nzOffset.top:i.pageY>n.bottom+e.nzOffset.top&&(i.pageY=n.bottom+e.nzOffset.top),i}};window.ProductMediaSlider=o}(jQuery),ProductMediaSlider.init();
